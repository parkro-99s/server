<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.parkro.server.domain.parking.mapper.ParkingMapper">

    <!-- 입차 -->
    <insert id="insertParking" parameterType="PostParkingReq">
        <selectKey keyProperty="parkingId" resultType="Integer" order="BEFORE">
            <![CDATA[
                SELECT parking_seq.nextval AS parkingId FROM dual
            ]]>
        </selectKey>
        <![CDATA[
        INSERT INTO parking (
            parking_id, parking_lot_id, car_number, member_id
        ) VALUES (
            #{parkingId}, #{parkingLotId}, #{carNumber}, #{memberId, jdbcType=INTEGER}
        )
        ]]>
    </insert>

    <!-- 출차 -->
    <update id="updateParkingOut" parameterType="PatchParkingReq">
        <![CDATA[
        UPDATE parking
        SET status = 'EXIT'
        WHERE parking_lot_id = #{parkingLotId}
          AND car_number = #{carNumber}
          AND status = 'PAY'
        ]]>
    </update>
</mapper>