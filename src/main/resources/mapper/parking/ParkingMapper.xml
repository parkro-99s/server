<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.parkro.server.domain.parking.mapper.ParkingMapper">

    <!-- 주차 정산(전) 정보 조회 -->
    <select id="selectParkingPay" parameterType="Integer" resultType="GetParkingPayRes">
        <![CDATA[
        SELECT
            p.car_number AS carNumber,
            s.name AS storeName,
            pl.name AS parkingLotName,
            p.entrance_date AS entranceDate,
            EXTRACT(HOUR FROM CURRENT_TIMESTAMP)-EXTRACT(HOUR FROM p.entrance_date) AS parkingTimeHour,
            EXTRACT(MINUTE FROM CURRENT_TIMESTAMP)-EXTRACT(MINUTE FROM p.entrance_date) AS parkingTimeMinute,
            pl.per_price AS perPrice
        FROM
            member m
        INNER JOIN
            parking p ON m.member_id = p.member_id
        INNER JOIN
            parking_lot pl ON p.parking_lot_id = pl.parking_lot_id
        INNER JOIN
            store s ON pl.store_id = s.store_id
        WHERE
            m.member_id = #{memberId}
            AND p.status = 'ENTRANCE'
        ]]>
    </select>
</mapper>
